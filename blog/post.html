<!DOCTYPE html>
<html lang="hr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Svijet Zdravlja | Blog objava</title>
    <link rel="stylesheet" href="../styles/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header class="header">
      <div class="header__container container">
        <a href="../index.html" class="header__logo">
          <img
            src="../images/logo/SZ_cijelilogo_transparent.png"
            alt="Svijet Zdravlja logo"
            class="header__logo-img"
          />
        </a>

        <nav class="header__nav">
          <ul class="header__nav-list">
            <li class="header__nav-item">
              <a href="../index.html" class="header__nav-link">Početna</a>
            </li>
            <li class="header__nav-item">
              <a href="#" class="header__nav-link">O nama</a>
            </li>
            <li class="header__nav-item">
              <a href="#" class="header__nav-link">Usluge</a>
            </li>
            <li class="header__nav-item">
              <a href="blog.html" class="header__nav-link">Blog</a>
            </li>
            <li class="header__nav-item">
              <a href="#" class="header__nav-link">Kontakt</a>
            </li>
          </ul>
        </nav>

        <button
          class="header__hamburger"
          aria-label="Toggle navigation"
          aria-expanded="false"
        >
          <span class="header__hamburger-line"></span>
          <span class="header__hamburger-line"></span>
          <span class="header__hamburger-line"></span>
        </button>
      </div>
    </header>

    <main class="post-page">
      <div
        class="post-page__container post-page__container--wide"
        style="
          display: flex;
          gap: 1rem;
          padding-left: 35px;
          padding-right: 40px;
        "
      >
        <!-- Floating TOC -->
        <nav id="floating-toc" class="toc" style="display: none">
          <h3 class="toc__title">Sadržaj bloga</h3>
          <ul id="toc-list" class="toc__list"></ul>
        </nav>
        <!-- POST -->
        <article
          id="post-article"
          class="post-detail"
          aria-live="polite"
          data-id=""
          style="flex: 1"
        >
          <p class="blog__eyebrow">Blog</p>
          <h1 id="post-title">Učitavanje objave...</h1>
          <div id="post-hero-wrap" class="post-detail__hero-wrap skeleton">
            <img
              id="post-hero"
              class="post-detail__hero post-detail__hero--rounded"
              alt="Naslovna slika objave"
              loading="lazy"
              width="1200"
              height="675"
            />
          </div>
          <div class="post-meta-bar post-meta-bar--columns">
            <div class="post-meta-bar__col post-meta-bar__col--left">
              <span class="post-meta-bar__label">Kategorija:</span>
              <span id="post-category" class="post-meta-bar__value"></span>
            </div>
            <div class="post-meta-bar__col post-meta-bar__col--center">
              <span class="post-meta-bar__label">Datum:</span>
              <span id="post-date" class="post-meta-bar__value"></span>
            </div>
            <div class="post-meta-bar__col post-meta-bar__col--right">
              <span class="post-meta-bar__label">Autor:</span>
              <span id="post-author" class="post-meta-bar__value"
                >Filip Jugović</span
              >
            </div>
          </div>
          <hr class="post-meta-bar__divider" />
          <p id="post-summary" class="post-summary"></p>
          <section id="post-content" class="post-detail__content"></section>
          <!-- ISTAKNUTI POSTOVI -->
          <hr class="post-meta-bar__divider" />
          <section class="featured-posts section">
            <div class="container" style="padding: 0">
              <header class="featured-posts__header text-center">
                <p class="blog__eyebrow">Novosti</p>
                <h2>Istaknuti postovi</h2>
                <p class="text-secondary">Najnoviji istaknuti članci s bloga</p>
              </header>

              <div
                id="featured-posts"
                class="post-list"
                aria-live="polite"
                aria-busy="false"
              ></div>

              <div class="text-center" style="margin-top: 1.5rem">
                <a href="../blog/blog.html" class="btn btn--secondary"
                  >Pogledaj sve objave</a
                >
              </div>
            </div>
          </section>
          <div
            class="post-detail__actions"
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div style="display: flex; gap: 1rem">
              <!-- Sakrij ove akcije po defaultu; prikaži samo admin -->
              <a
                id="post-edit"
                class="btn btn--edit admin-only"
                href="create.html"
                aria-hidden="true"
                >Uredi objavu</a
              >
              <button
                id="post-delete"
                class="btn btn--delete admin-only"
                type="button"
                aria-hidden="true"
              >
                Izbriši objavu
              </button>
            </div>
            <a
              id="post-back"
              class="btn btn--secondary"
              href="../blog/blog.html"
              >Natrag</a
            >
          </div>
        </article>
      </div>
    </main>

    <footer class="footer">
      <div class="footer__container container">
        <div class="footer__content">
          <div class="footer__brand">
            <a href="../index.html" class="footer__logo">
              <img
                src="../images/logo/SZ_cijelilogo_transparent.png"
                alt="Svijet Zdravlja logo"
                class="footer__logo-img"
              />
            </a>
            <p class="footer__description">
              Vaš pouzdani partner za zdravlje i dobrobit.
            </p>
          </div>

          <div class="footer__links">
            <div class="footer__column">
              <h4 class="footer__title">Navigacija</h4>
              <ul class="footer__list">
                <li class="footer__list-item">
                  <a href="../index.html" class="footer__link">Početna</a>
                </li>
                <li class="footer__list-item">
                  <a href="#" class="footer__link">O nama</a>
                </li>
                <li class="footer__list-item">
                  <a href="#" class="footer__link">Usluge</a>
                </li>
                <li class="footer__list-item">
                  <a href="index.html" class="footer__link">Blog</a>
                </li>
              </ul>
            </div>

            <div class="footer__column">
              <h4 class="footer__title">Kontakt</h4>
              <ul class="footer__list">
                <li class="footer__list-item">
                  <a href="tel:+385123456789" class="footer__link"
                    >+385 12 345 6789</a
                  >
                </li>
                <li class="footer__list-item">
                  <a href="mailto:info@svijet-zdravlja.hr" class="footer__link"
                    >info@svijet-zdravlja.hr</a
                  >
                </li>
                <li class="footer__list-item">
                  <span class="footer__text">Zagreb, Hrvatska</span>
                </li>
              </ul>
            </div>

            <div class="footer__column">
              <h4 class="footer__title">Pratite nas</h4>
              <ul class="footer__social">
                <li class="footer__social-item">
                  <a href="#" class="footer__social-link" aria-label="Facebook">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </a>
                </li>
                <li class="footer__social-item">
                  <a
                    href="#"
                    class="footer__social-link"
                    aria-label="Instagram"
                  >
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <rect
                        x="2"
                        y="2"
                        width="20"
                        height="20"
                        rx="5"
                        ry="5"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <circle
                        cx="12"
                        cy="12"
                        r="4"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" />
                    </svg>
                  </a>
                </li>
                <li class="footer__social-item">
                  <a href="#" class="footer__social-link" aria-label="LinkedIn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6zM2 9h4v12H2z"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <circle
                        cx="4"
                        cy="4"
                        r="2"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                    </svg>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="footer__bottom">
          <p class="footer__copyright">
            &copy; 2025 Svijet Zdravlja. Sva prava pridržana.
          </p>
        </div>
      </div>
    </footer>

    <script src="../scripts/main.js"></script>
    <script src="../scripts/config.js"></script>
    <script src="../scripts/blog.js"></script>
    <script src="../scripts/home-featured.js"></script>
    <!-- Centralizirana provjera/otkrivanje admin elemenata -->
    <script src="../scripts/admin-guard.js"></script>
    <script src="../scripts/toast.js"></script>
    <script>
      // Floating TOC generator
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
          const postContent = document.getElementById("post-content");
          if (!postContent) return;

          const chapterTitles = postContent.querySelectorAll(
            "h3.post-chapter__title"
          );
          if (chapterTitles.length === 0) return;

          const tocList = document.getElementById("toc-list");
          tocList.innerHTML = "";

          // Kontrola za ručno kliknuti TOC (da scroll event ne preuzima odmah)
          let tocClickInProgress = false;
          let tocClickTimeout = null;

          chapterTitles.forEach((h3, idx) => {
            if (!h3.id) h3.id = "chapter-" + (idx + 1);
            h3.style.scrollMarginTop = "130px";

            const li = document.createElement("li");
            const a = document.createElement("a");
            a.href = "#" + h3.id;
            a.textContent = h3.textContent;
            a.className = "toc__item";
            a.tabIndex = 0;
            // Smooth scroll handler - spriječi scroll event highlight dok traje scroll
            a.addEventListener("click", function (e) {
              e.preventDefault();
              document
                .querySelectorAll(".toc__item")
                .forEach((el) => el.classList.remove("toc__item--active"));
              document
                .getElementById(h3.id)
                .scrollIntoView({ behavior: "smooth" });

              tocClickInProgress = true;
              a.classList.add("toc__item--active");
              // Makni focus s linka nakon klika (da ne ostane outline/tab)
              a.blur();
              if (tocClickTimeout) clearTimeout(tocClickTimeout);
              tocClickTimeout = setTimeout(() => {
                tocClickInProgress = false;
              }, 700); // dulje od trajanja scrolla
            });
            li.appendChild(a);
            tocList.appendChild(li);
          });

          // Prikaži TOC
          document.getElementById("floating-toc").style.display = "block";

          // Highlight active TOC item on scroll, ali ne dok je tocClickInProgress
          let lastActiveIdx = -1;
          window.addEventListener("scroll", function () {
            if (tocClickInProgress) return;
            let activeIdx = -1;
            // Pronađi najbliži naslov iznad vrha (ili najbliži ispod ako nema iznad)
            let minDist = Infinity;
            chapterTitles.forEach((h3, idx) => {
              const rect = h3.getBoundingClientRect();
              const dist = Math.abs(rect.top - 140);
              if (rect.top < 140 && dist < minDist) {
                minDist = dist;
                activeIdx = idx;
              }
            });
            if (activeIdx === -1) {
              // Ako nema iznad, uzmi prvi ispod
              chapterTitles.forEach((h3, idx) => {
                const rect = h3.getBoundingClientRect();
                if (rect.top >= 140 && activeIdx === -1) activeIdx = idx;
              });
            }
            if (activeIdx !== lastActiveIdx) {
              document.querySelectorAll(".toc__item").forEach((el, idx) => {
                el.classList.toggle("toc__item--active", idx === activeIdx);
              });
              lastActiveIdx = activeIdx;
            }
          });
        }, 500);
      });
    </script>
    <script type="module" src="../scripts/analytics.js"></script>

  </body>
</html>
