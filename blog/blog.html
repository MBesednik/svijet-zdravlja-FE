<!DOCTYPE html>
<html lang="hr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Svijet Zdravlja | Blog</title>
    <link rel="stylesheet" href="../styles/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* Osigurava da footer stoji na dnu i uklanja bijeli razmak ispod */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        /* Ukloni višak: NE koristiti align-items ili justify-content ovdje */
        /* NE koristiti position: relative ili z-index */
      }
      main,
      .site-main,
      .content {
        flex: 1;
        /* Ukloni višak: NE koristiti position: relative */
      }

      /* Jednostavna centrirana poruka bez kontejnera */
      .no-blogs {
        color: #3d4a2c; /* tražena boja fonta */
        font-size: 1.15rem;
        text-align: center;
        padding: 40px 20px;
        align-items: center;
        justify-content: center;
      }
      .no-blogs {
        display: none;
      } /* skriveno dok se ne pokaže */
      .no-blogs.show {
        display: flex;
      } /* prikazuje kao flex da centriranje radi */

      /* --- Loader styles --- */
      .blog__container {
        position: relative; /* omogućuje overlay unutar container-a */
        /* Ukloni višak: NE koristiti margin-top ili padding-top koji bi gurao header */
      }
      .loader-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.9);
        z-index: 50;
      }
      .loader-overlay.hidden {
        display: none;
      }
      .loader-spinner {
        width: 48px;
        height: 48px;
        border: 6px solid #e6e6e6;
        border-top-color: #3d4a2c; /* tražena boja */
        border-radius: 50%;
        animation: loader-spin 1s linear infinite;
      }
      .loader-text {
        margin-top: 12px;
        color: #3d4a2c;
        font-size: 0.95rem;
      }
      @keyframes loader-spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Sakrij administratorske elemente po defaultu */
      .admin-only {
        display: none !important;
      }

      /* Toast styles */
      #toast-container {
        position: fixed;
        top: 32px;
        right: 32px;
        z-index: 9999;
        pointer-events: none;
      }
      .toast {
        min-width: 280px;
        max-width: 400px;
        background: #fbeaea;
        color: #b71c1c;
        font-size: 1.15rem;
        font-family: inherit;
        font-weight: 600;
        padding: 20px 36px 20px 24px;
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
        opacity: 0.98;
        margin-bottom: 18px;
        display: flex;
        align-items: center;
        position: relative;
        transform: translateX(120%);
        transition: transform 0.5s cubic-bezier(0.4, 1.4, 0.6, 1), opacity 0.4s;
        pointer-events: auto;
        border: 1.5px solid #f3bcbc;
        overflow: hidden;
      }
      .toast--show {
        transform: translateX(0);
      }
      .toast--hide {
        opacity: 0;
        transform: translateX(120%);
      }
      .toast__close {
        margin-left: 18px;
        background: none;
        border: none;
        color: #b71c1c;
        font-size: 1.2em;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s;
        pointer-events: auto;
      }
      .toast__close:hover {
        opacity: 1;
      }
      .toast--error {
        background: #fbeaea;
        color: #b71c1c;
        border: 1.5px solid #f3bcbc;
      }
      .toast__progress {
        position: absolute;
        left: 0;
        bottom: 0;
        height: 0;
        width: 100%;
        border-bottom: 4px solid #d32f2f;
        border-radius: 0 0 16px 16px;
        /* Animacija: s desna na lijevo */
        transform: scaleX(1);
        transform-origin: right; /* <-- ovo je ključno za desno-lijevo */
        animation: toast-progress-bar 3.5s linear forwards;
        pointer-events: none;
      }
      @keyframes toast-progress-bar {
        from {
          transform: scaleX(1);
        }
        to {
          transform: scaleX(0);
        }
      }

      /* NOVI LAYOUT: sidebar + main */
      .blog__layout {
        display: flex;
        gap: 2.5rem;
        align-items: stretch; /* sidebar i main iste visine */
      }
      .blog__sidebar {
        flex: 0 0 320px;
        max-width: 340px;
        background: #f4f6f2;
        border-radius: 18px;
        padding: 0;
        box-shadow: 0 1.5px 8px rgba(61, 74, 44, 0.07);
        min-height: 420px;
        height: 100%;
        position: sticky;
        top: 135px;
        margin-bottom: 2rem;
        display: flex;
        flex-direction: column;
      }
      .blog__filters {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        height: 100%;
        flex: 1 1 auto;
        justify-content: stretch;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 1.5px 8px rgba(61, 74, 44, 0.07);
      }
      .blog__filter-field {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      .blog__filter-field input,
      .blog__filter-field select {
        font-size: 1rem;
        padding: 0.7em 1em;
        border-radius: 8px;
        border: 1.5px solid #dbe2d3;
        background: #fff;
        color: #3d4a2c;
        font-family: inherit;
        outline: none;
        transition: border 0.2s;
      }
      .blog__filter-field input:focus,
      .blog__filter-field select:focus {
        border-color: #3d4a2c;
      }
      .blog__filters label span {
        font-weight: 600;
        color: #3d4a2c;
        margin-bottom: 0.2em;
      }
      /* Blog list: prikaz jednog po jednog */
      .blog-list {
        width: 100%;
      }
      .post-list {
        display: flex;
        flex-direction: column;
        gap: 2.5rem;
        /* Dodano: uvijek zauzmi punu širinu */
        width: 100%;
      }
      .post-list > .post-card {
        width: 100%;
        /* Dodano: uvijek puni red, bez max-width */
      }
      /* STARI STIL KARTICE: slika lijevo, sadržaj desno */
      .post-card {
        display: flex;
        flex-direction: column;
        background: #fff;
        border-radius: 18px;
        /* Smanjeni shadow i dodan border */
        box-shadow: 0 2px 8px rgba(61, 74, 44, 0.07);
        border: 1.5px solid #e6ede0;
        padding: 0;
        overflow: hidden;
        min-height: 0;
        position: relative;
        transition: box-shadow 0.18s, border 0.18s;
      }
      .post-card__image {
        width: 100%;
        height: 320px;
        object-fit: cover;
        display: block;
        border-radius: 0;
        background: #f4f6f2;
      }
      .post-card__content {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 18px 22px 18px 22px; /* dodan padding sa svih strana */
        gap: 0;
      }
      .post-card__info {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding: 0;
        margin: 0;
        gap: 0.3rem;
      }
      .post-card__title {
        font-size: 2rem;
        font-weight: 700;
        color: #3d4a2c;
        margin: 0 0 0.2em 0;
        line-height: 1.15;
        width: 100%;
        text-align: left;
        padding: 0;
      }
      .post-card__excerpt {
        color: #5a5f56;
        font-size: 1.13rem;
        margin: 0 0 0.5em 0;
        line-height: 1.6;
        width: 100%;
        text-align: left;
        padding: 0;
      }
      .post-card__meta {
        font-size: 1.08rem;
        color: #7b8a6c;
        margin-bottom: 0.5em;
        display: flex;
        gap: 1.2em;
        width: 100%;
        text-align: left;
        padding: 0;
      }
      /* Badge za kategoriju */
      .post-card__category-badge {
        display: inline-block;
        background: #e6ede0;
        color: #3d4a2c;
        font-size: 1.02rem;
        font-weight: 700;
        border-radius: 8px;
        padding: 0.28em 1.1em 0.28em 1.1em;
        margin-bottom: 0.7em;
        margin-right: 0.7em;
        letter-spacing: 0.01em;
        box-shadow: 0 1px 4px rgba(61, 74, 44, 0.08);
      }
      .post-card__categories {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5em;
        margin-bottom: 0.5em;
        width: 100%;
        text-align: left;
        padding: 0;
      }
      .post-card__read {
        margin-top: 1.2em;
        padding: 0.6em 1.6em;
        border-radius: 8px;
        background: #e6ede0;
        color: #3d4a2c;
        font-weight: 700;
        text-decoration: none;
        font-size: 1.08rem;
        letter-spacing: 0.01em;
        transition: background 0.18s;
        border: none;
        box-shadow: none;
        display: block;
        width: 70%;
        text-align: center;
        align-self: center;
      }
      .post-card__read:hover {
        background: #dbe2d3;
      }
      .category-buttons-container {
        width: 100%;
        margin-top: 0.5em;
        background: none;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        border-radius: 18px;
        /* box-shadow: 0 1.5px 8px rgba(61, 74, 44, 0.07); */
        overflow: hidden;
      }
      .category-buttons {
        display: flex;
        flex-direction: column;
        gap: 0;
        width: 100%;
      }
      .category-btn {
        width: 100%;
        display: flex;
        align-items: center;
        background: #e6ede0;
        color: #3d4a2c;
        border: none;
        border-radius: 0;
        padding: 1em 1.3em 1em 1.3em;
        font-size: 1.08rem; /* promijeni na 1.02rem kao .post-card__read */
        font-size: 1.02rem;
        font-weight: 600;
        text-align: left;
        cursor: pointer;
        transition: background 0.18s, color 0.18s, box-shadow 0.15s,
          transform 0.12s;
        border-bottom: 1px solid #dbe2d3;
        position: relative;
        outline: none;
        min-height: 48px;
        justify-content: space-between;
        letter-spacing: 0.01em;
      }
      .category-btn:last-child {
        border-bottom: none;
      }
      .category-btn .cat-arrow {
        margin-left: 1.2em;
        font-size: 1.25em;
        color: #3d4a2c;
        transition: color 0.18s, transform 0.18s;
        flex-shrink: 0;
        display: inline-block;
        font-family: inherit;
        font-weight: 700;
        /* Strelica kao na roru natura: koristi SVG za bolju kontrolu */
        width: 1em;
        height: 1em;
        line-height: 1;
      }
      .category-btn.active,
      .category-btn:focus {
        background: #3d4a2c !important;
        color: #fff !important;
        font-weight: 700;
        border-radius: 0;
        box-shadow: 0 2px 8px rgba(61, 74, 44, 0.1) inset;
        z-index: 1;
        border-bottom: none;
        position: relative;
      }
      /* Za prvi i zadnji gumb zadrži zaobljenje */
      .category-btn:first-child.active,
      .category-btn:first-child:focus {
        border-top-left-radius: 18px;
        border-top-right-radius: 18px;
      }
      .category-btn:last-child.active,
      .category-btn:last-child:focus {
        border-bottom-left-radius: 18px;
        border-bottom-right-radius: 18px;
      }

      /* Crta ispod teksta na aktivnom gumbu - uvijek vidljiva, bez animacije */
      .category-btn.active::after,
      .category-btn:focus::after {
        content: "";
        display: block;
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 4px;
        background: #3d4a2c;
        border-radius: 0 0 18px 18px;
        /* crta ide cijelom širinom gumba */
        z-index: 2;
      }

      /* Ukloni border-bottom na aktivnom da ne izgleda kao dvostruka crta */
      .category-btn.active,
      .category-btn:focus {
        border-bottom: none;
      }
      /* Dodaj border samo na neaktivnim */
      .category-btn:not(.active):not(:focus) {
        border-bottom: 1px solid #dbe2d3;
      }

      /* Onemogući hover promjene za aktivni gumb */
      .category-btn.active:hover,
      .category-btn.active:focus {
        background: #3d4a2c !important;
        color: #fff !important;
      }
      @media (max-width: 900px) {
        .blog__layout {
          flex-direction: column;
        }
        .blog__sidebar {
          position: static;
          max-width: 100%;
          width: 100%;
        }
        .post-card__image {
          height: 200px;
        }
        .post-card__content {
          padding: 18px 0 16px 0;
        }
        .post-card__title,
        .post-card__excerpt,
        .post-card__meta,
        .post-card__categories,
        .post-card__read {
          width: 90%;
        }
        .post-card__title {
          font-size: 1.3rem;
        }
      }
      @media (max-width: 600px) {
        .blog__sidebar {
          padding: 0;
        }
        .post-card__image {
          height: 140px;
        }
        .post-card__content {
          padding: 10px 0 12px 0;
        }
        .post-card__title,
        .post-card__excerpt,
        .post-card__meta,
        .post-card__categories,
        .post-card__read {
          width: 100%;
        }
      }
      .blog__filter-field--category {
        /* Helper klasa za lakše targetiranje */
      }
      /* Sakrij dropdown i labelu na desktopu, prikaži na tabletu/mobitelu */
      @media (min-width: 901px) {
        .blog__filter-field--category {
          display: none !important;
        }
        .category-buttons-container {
          display: flex !important;
        }
      }
      @media (max-width: 900px) {
        .blog__filter-field--category {
          display: flex !important;
        }
        .category-buttons-container {
          display: none !important;
        }
      }

      /* Header styles */
      .header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 100;
        background: #fff;
        transition: box-shadow 0.18s;
        box-shadow: 0 4px 18px rgba(61, 74, 44, 0.09);
      }
      body {
        /* ...existing code... */
        padding-top: 92px; /* visina headera, prilagodi po potrebi */
      }
      @media (max-width: 900px) {
        body {
          padding-top: 72px;
        }
      }
      /* Ukloni sticky header varijante i animacije */
      .header--sticky {
        /* Više nije potrebno, ali ostavljeno radi kompatibilnosti */
        /* prazno */
      }
      body.has-sticky-header {
        /* prazno */
      }
      @keyframes sticky-header-fadein {
      }

      /* Loader spinner for category buttons */
      .category-loader-spinner {
        width: 32px;
        height: 32px;
        border: 4px solid #e6e6e6;
        border-top-color: #3d4a2c;
        border-radius: 50%;
        animation: loader-spin 0.9s linear infinite;
        margin: 18px auto;
        display: block;
      }
      /* Fade animation for category buttons */
      .category-buttons.fade-out {
        opacity: 0;
        transition: opacity 0.25s;
        pointer-events: none;
      }
      .category-buttons.fade-in {
        opacity: 1;
        transition: opacity 0.25s;
      }
      .category-count-badge {
        display: inline-block;
        min-width: 28px;
        padding: 0 8px;
        height: 22px;
        background: #e6ede0;
        color: #3d4a2c;
        font-size: 0.98rem;
        font-weight: 700;
        border-radius: 12px;
        margin-left: 12px;
        text-align: center;
        line-height: 22px;
        vertical-align: middle;
        box-shadow: 0 1px 4px rgba(61, 74, 44, 0.08);
        /* Za aktivnu kategoriju badge je bijeli */
        transition: background 0.18s, color 0.18s;
      }
      .category-btn.active .category-count-badge,
      .category-btn:focus .category-count-badge {
        background: #fff;
        color: #3d4a2c;
      }
    </style>
  </head>
  <body>
    <div id="toast-container"></div>
    <header class="header">
      <div class="header__container container">
        <a href="../index.html" class="header__logo">
          <img
            src="../images/logo/SZ_cijelilogo_transparent.png"
            alt="Svijet Zdravlja logo"
            class="header__logo-img"
          />
        </a>

        <nav class="header__nav">
          <ul class="header__nav-list">
            <li class="header__nav-item">
              <a href="../index.html" class="header__nav-link">Početna</a>
            </li>
            <li class="header__nav-item">
              <a href="#" class="header__nav-link">O nama</a>
            </li>
            <li class="header__nav-item">
              <a href="#" class="header__nav-link">Usluge</a>
            </li>
            <li class="header__nav-item">
              <a href="#" class="header__nav-link" aria-current="page">Blog</a>
            </li>
            <li class="header__nav-item">
              <a href="../contact.html" class="header__nav-link">Kontakt</a>
            </li>
          </ul>
        </nav>

        <button
          class="header__hamburger"
          aria-label="Toggle navigation"
          aria-expanded="false"
        >
          <span class="header__hamburger-line"></span>
          <span class="header__hamburger-line"></span>
          <span class="header__hamburger-line"></span>
        </button>
      </div>
    </header>

    <main class="blog">
      <div class="blog__container container">
        <!-- Loader koji ostaje vidljiv dok se učitava sadržaj -->
        <div
          class="loader-overlay"
          role="status"
          aria-live="polite"
          aria-label="Učitavanje sadržaja"
        >
          <div class="loader-spinner" aria-hidden="true"></div>
          <div class="loader-text">Učitavanje objava...</div>
        </div>

        <header class="blog__header">
          <div>
            <p class="blog__eyebrow">Novosti i savjeti</p>
            <h1>Svijet Zdravlja blog</h1>
            <p>
              Upravljajte objavama, filtrirajte teme i u nekoliko klikova
              dijelite priče o zdravlju i prehrani.
            </p>
          </div>
          <!-- Sakrij gumb po defaultu; prikaži ga samo ako postoji svz_admin_token -->
          <a
            href="create.html"
            class="btn btn--primary admin-only"
            aria-hidden="true"
            >+ Nova objava</a
          >
        </header>

        <div class="blog__layout">
          <!-- Sidebar s filterima -->
          <aside class="blog__sidebar" aria-label="Filteri blogova">
            <form
              class="blog__filters"
              aria-label="Filtriranje i pretraživanje objava"
              onsubmit="return false;"
            >
              <label class="blog__filter-field" for="posts-search">
                <span>Pretraži</span>
                <input
                  type="search"
                  id="posts-search"
                  name="search"
                  placeholder="Pretraži objave..."
                  autocomplete="off"
                />
              </label>
              <label class="blog__filter-field" for="posts-sort">
                <span>Sortiraj</span>
                <select id="posts-sort" name="sort">
                  <option value="newest">Učitavanje...</option>
                </select>
              </label>
              <!-- Dodaj helper klasu na kategorije -->
              <label
                class="blog__filter-field blog__filter-field--category"
                for="posts-filter-category"
              >
                <span>Kategorija</span>
                <select id="posts-filter-category" name="category">
                  <option value="all">Sve kategorije</option>
                </select>
              </label>
            </form>
            <!-- Novi kontejner za kategorije ispod filtera -->
            <div
              id="category-buttons-container"
              class="category-buttons-container"
            >
              <div id="category-buttons" class="category-buttons"></div>
            </div>
          </aside>
          <!-- Glavni prikaz blogova -->
          <section class="blog__main">
            <div class="blog-list">
              <div
                id="posts-list"
                class="post-list"
                aria-live="polite"
                aria-busy="false"
              ></div>
            </div>
            <div class="no-blogs" aria-live="polite">Blogovi dolaze.</div>
          </section>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer__container container">
        <div class="footer__content">
          <div class="footer__brand">
            <a href="../index.html" class="footer__logo">
              <img
                src="../images/logo/SZ_cijelilogo_transparent.png"
                alt="Svijet Zdravlja logo"
                class="footer__logo-img"
              />
            </a>
            <p class="footer__description">
              Vaš pouzdani partner za zdravlje i dobrobit.
            </p>
          </div>

          <div class="footer__links">
            <div class="footer__column">
              <h4 class="footer__title">Navigacija</h4>
              <ul class="footer__list">
                <li class="footer__list-item">
                  <a href="../index.html" class="footer__link">Početna</a>
                </li>
                <li class="footer__list-item">
                  <a href="#" class="footer__link">O nama</a>
                </li>
                <li class="footer__list-item">
                  <a href="#" class="footer__link">Usluge</a>
                </li>
                <li class="footer__list-item">
                  <a href="#" class="footer__link">Blog</a>
                </li>
                <li class="footer__list-item">
                  <a href="../contact.html" class="footer__link">Kontakt</a>
                </li>
              </ul>
            </div>

            <div class="footer__column">
              <h4 class="footer__title">Kontakt</h4>
              <ul class="footer__list">
                <li class="footer__list-item">
                  <a href="tel:+385123456789" class="footer__link"
                    >+385 12 345 6789</a
                  >
                </li>
                <li class="footer__list-item">
                  <a href="mailto:info@svijet-zdravlja.hr" class="footer__link"
                    >info@svijet-zdravlja.hr</a
                  >
                </li>
                <li class="footer__list-item">
                  <span class="footer__text">Zagreb, Hrvatska</span>
                </li>
              </ul>
            </div>

            <div class="footer__column">
              <h4 class="footer__title">Pratite nas</h4>
              <ul class="footer__social">
                <li class="footer__social-item">
                  <a href="#" class="footer__social-link" aria-label="Facebook">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </a>
                </li>
                <li class="footer__social-item">
                  <a
                    href="#"
                    class="footer__social-link"
                    aria-label="Instagram"
                  >
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <rect
                        x="2"
                        y="2"
                        width="20"
                        height="20"
                        rx="5"
                        ry="5"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <circle
                        cx="12"
                        cy="12"
                        r="4"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" />
                    </svg>
                  </a>
                </li>
                <li class="footer__social-item">
                  <a href="#" class="footer__social-link" aria-label="LinkedIn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6zM2 9h4v12H2z"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <circle
                        cx="4"
                        cy="4"
                        r="2"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                    </svg>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="footer__bottom">
          <p class="footer__copyright">
            &copy; 2025 Svijet Zdravlja. Sva prava pridržana.
          </p>
        </div>
      </div>
    </footer>

    <script src="../scripts/loader.js"></script>
    <script src="../scripts/main.js"></script>
    <script src="../scripts/config.js"></script>
    <script src="../scripts/blog.js"></script>
    <script src="../scripts/admin-guard.js"></script>
    <script>
      // Toast logic for deleted blog
      (function () {
        function showToast(message, type = "error", duration = 3500) {
          const container = document.getElementById("toast-container");
          if (!container) return;
          const toast = document.createElement("div");
          toast.className = `toast toast--${type}`;
          toast.innerHTML = `
            <span>${message}</span>
            <button class="toast__close" aria-label="Zatvori">&times;</button>
            <div class="toast__progress"></div>
          `;
          container.appendChild(toast);
          // Slide in
          setTimeout(() => toast.classList.add("toast--show"), 10);
          // Auto close
          const removeToast = () => {
            toast.classList.remove("toast--show");
            toast.classList.add("toast--hide");
            setTimeout(() => toast.remove(), 500);
          };
          setTimeout(removeToast, duration);
          toast.querySelector(".toast__close").onclick = removeToast;
        }
        // Show toast if status=deleted in URL
        const params = new URLSearchParams(window.location.search);
        if (params.get("status") === "deleted") {
          showToast("Obrisali ste objavu.", "error", 3500);
          params.delete("status");
          const query = params.toString();
          const url = window.location.pathname + (query ? "?" + query : "");
          window.history.replaceState({}, "", url);
        }
      })();
    </script>
    <script type="module" src="../scripts/analytics.js"></script>
    <script>
      // Prikaz kategorija kao gumbi ispod dropdowna
      function renderCategoryButtons(categories, selected) {
        const container = document.getElementById("category-buttons");
        if (!container) return;
        container.innerHTML = "";
        if (!categories || !categories.length) return;
        categories.forEach(function (cat) {
          let slug, name;
          if (typeof cat === "string") {
            slug = cat;
            name = cat;
          } else if (cat && typeof cat === "object") {
            slug = cat.slug || cat.name || "";
            name = cat.name || cat.slug || "";
          } else {
            return;
          }
          if (!slug || !name) return;
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "category-btn" + (slug === selected ? " active" : "");
          // SVG strelica kao na roru natura, desno od naziva
          btn.innerHTML = `<span class="cat-label">${name}</span>
            <span class="cat-arrow" aria-hidden="true">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none" style="display:inline-block;vertical-align:middle;">
                <path d="M6 3l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>`;
          btn.onclick = function () {
            const select = document.getElementById("posts-filter-category");
            if (select) {
              select.value = slug;
              select.dispatchEvent(new Event("change", { bubbles: true }));
            }
          };
          container.appendChild(btn);
        });
      }

      // Dohvati kategorije iz backenda i prikaži kao gumbi
      async function fetchAndRenderCategoryButtons(selected) {
        const container = document.getElementById("category-buttons");
        if (!container) return;

        // Fade out current buttons
        container.classList.remove("fade-in");
        container.classList.add("fade-out");

        // Prikaži spinner nakon fade-out
        setTimeout(() => {
          container.innerHTML =
            '<div class="category-loader-spinner" aria-label="Učitavanje kategorija"></div>';
          container.classList.remove("fade-out");
        }, 220);

        try {
          // Dohvati kategorije
          const catResp = await fetch(window.getSVZApiBase() + "/categories");
          const catData = await catResp.json();
          let categories = [];
          if (Array.isArray(catData)) {
            categories = catData.map((cat) =>
              typeof cat === "string"
                ? { name: String(cat) }
                : {
                    name: String(cat.name || cat),
                    is_visible_for_public: cat.is_visible_for_public,
                  }
            );
          } else if (Array.isArray(catData.categories)) {
            categories = catData.categories.map((cat) =>
              typeof cat === "string"
                ? { name: String(cat) }
                : {
                    name: String(cat.name || cat),
                    is_visible_for_public: cat.is_visible_for_public,
                  }
            );
          }
          categories = categories.filter(
            (cat) =>
              cat &&
              cat.name &&
              (typeof cat.is_visible_for_public === "undefined" ||
                cat.is_visible_for_public === true ||
                cat.is_visible_for_public === "true" ||
                cat.is_visible_for_public === 1 ||
                cat.is_visible_for_public === "1")
          );

          // Dohvati sve blogove
          const postsResp = await fetch(window.getSVZApiBase() + "/posts");
          const postsData = await postsResp.json();
          let posts = Array.isArray(postsData)
            ? postsData
            : postsData.posts || [];

          // Provjeri je li admin
          const isAdmin = !!window.localStorage.getItem("svz_admin_token");

          // Filtriraj blogove za prikaz
          let visiblePosts;
          if (isAdmin) {
            visiblePosts = posts;
          } else {
            visiblePosts = posts.filter(
              (post) =>
                post.status === "objavljeno" || post.status === "published"
            );
          }

          // Dodaj "Sve kategorije" na vrh s ukupnim brojem blogova
          const totalCount = visiblePosts.length;
          categories.unshift({
            name: "Sve kategorije",
            count: totalCount,
          });

          // Dodaj count za svaku kategoriju (broji blogove koji sadrže tu kategoriju po name)
          categories = categories.map((cat) => ({
            ...cat,
            count:
              cat.name === "Sve kategorije"
                ? totalCount
                : visiblePosts.filter(
                    (post) =>
                      Array.isArray(post.categories) &&
                      post.categories.some(
                        (postCat) =>
                          String(postCat).trim() !== "" &&
                          String(postCat) === String(cat.name)
                      )
                  ).length,
          }));

          setTimeout(() => {
            container.innerHTML = "";
            categories.forEach((cat) => {
              const btn = document.createElement("button");
              btn.type = "button";
              btn.className =
                "category-btn" +
                ((selected || "Sve kategorije") === cat.name ? " active" : "");
              btn.innerHTML = `
                <span class="cat-label">${cat.name}</span>
                <span class="category-count-badge">${cat.count}</span>
              `;
              btn.onclick = function () {
                const select = document.getElementById("posts-filter-category");
                if (select) {
                  select.value = cat.name;
                  select.dispatchEvent(new Event("change", { bubbles: true }));
                }
                Array.from(container.children).forEach((b) =>
                  b.classList.remove("active")
                );
                btn.classList.add("active");
              };
              container.appendChild(btn);
            });
            container.classList.add("fade-in");
          }, 350);
        } catch (e) {
          setTimeout(() => {
            container.innerHTML =
              "<span style='color:#b71c1c'>Greška kod učitavanja kategorija</span>";
            container.classList.add("fade-in");
          }, 350);
        }
      }

      // Sinkroniziraj gumbove kad se promijeni dropdown
      document.addEventListener("DOMContentLoaded", function () {
        const select = document.getElementById("posts-filter-category");
        if (select) {
          select.addEventListener("change", function () {
            fetchAndRenderCategoryButtons(select.value);
          });
        }
        // Prvo učitavanje
        fetchAndRenderCategoryButtons(select ? select.value : "all");
      });
    </script>
  </body>
</html>
