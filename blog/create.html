<!DOCTYPE html>
<html lang="hr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Svijet Zdravlja | Nova objava</title>
    <link rel="stylesheet" href="../styles/style.css" />
    <link rel="stylesheet" href="../styles/admin.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .loader-overlay {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.9);
        z-index: 2000;
      }
      .loader-overlay.hidden {
        display: none;
      }
      .loader-spinner {
        width: 48px;
        height: 48px;
        border: 6px solid #e6e6e6;
        border-top-color: #3d4a2c;
        border-radius: 50%;
        animation: loader-spin 1s linear infinite;
      }
      .loader-text {
        margin-top: 12px;
        color: #3d4a2c;
        font-size: 0.95rem;
      }
      @keyframes loader-spin {
        to {
          transform: rotate(360deg);
        }
      }
      /* Žuti gumb za "Spremi kao skicu" i "Uredi objavu" */
      .btn--edit,
      .btn--draft {
        background: #ffe066;
        color: #3d4a2c;
        border: 2px solid #ffe066;
        transition: background 0.2s, color 0.2s, border 0.2s;
      }
      .btn--edit:hover,
      .btn--edit:focus,
      .btn--draft:hover,
      .btn--draft:focus {
        background: #fff3bf;
        color: #3d4a2c;
        border-color: #ffd43b;
      }

      #toast-container {
        position: fixed;
        top: 2rem;
        right: 2rem;
        z-index: 3000;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        pointer-events: none;
      }
      .toast {
        min-width: 220px;
        max-width: 350px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 16px 0 rgba(60, 60, 60, 0.08);
        font-size: 1rem;
        font-weight: 500;
        color: #2d3a1d;
        background: #e6f9e6;
        /* Uklonjen border-left */
        /* border-left: 6px solid #51cf66; */
        opacity: 0.98;
        pointer-events: auto;
        transition: opacity 0.3s, transform 0.4s cubic-bezier(0.4, 1.4, 0.6, 1),
          max-height 0.3s;
        transform: translateX(120%);
        max-height: 200px;
        position: relative;
        overflow: hidden;
      }
      .toast.toast-success {
        background: #e6f9e6;
        /* border-left-color: #51cf66; */
        color: #2d3a1d;
      }
      .toast.toast-error {
        background: #fff0f0;
        /* border-left-color: #fa5252; */
        color: #a4161a;
      }
      .toast.toast-info {
        background: #e7f5ff;
        /* border-left-color: #228be6; */
        color: #1864ab;
      }
      .toast.toast-show {
        transform: translateX(0);
      }
      .toast.toast-hide {
        opacity: 0;
        max-height: 0;
        transform: translateX(120%);
      }
      .toast__close {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem; /* smanjeno s 1.25rem na 0.5rem */
        background: none;
        border: none;
        color: inherit;
        font-size: 1.25rem;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s;
        pointer-events: auto;
        z-index: 2;
        padding-left: 1.25rem; /* dodatno udalji X od teksta */
      }
      .toast__close:hover,
      .toast__close:focus {
        opacity: 1;
      }
      .toast__bar {
        position: absolute;
        left: 0;
        bottom: 0;
        height: 4px;
        width: 100%;
        background: linear-gradient(90deg, #ffd43b 0%, #ffe066 100%);
        border-radius: 0 0 8px 8px;
        transform: scaleX(1);
        transform-origin: left;
        transition: none;
        z-index: 1;
      }
      .toast.toast-success .toast__bar {
        background: linear-gradient(90deg, #51cf66 0%, #b2f2bb 100%);
      }
      .toast.toast-error .toast__bar {
        background: linear-gradient(90deg, #fa5252 0%, #ffa8a8 100%);
      }
      .toast.toast-info .toast__bar {
        background: linear-gradient(90deg, #228be6 0%, #a5d8ff 100%);
      }
    </style>
  </head>
  <body>
    <!-- Ako korisnik nije admin, enforceAdminAccess će ga odmah preusmjeriti -->
    <script src="../scripts/admin-guard.js"></script>
    <script>
      // Pozivemo zaštitu odmah nakon učitavanja
      document.addEventListener("DOMContentLoaded", function () {
        if (window.adminGuard) {
          window.adminGuard.enforceAdminAccess("../404.html");
        }
      });
    </script>

    <header class="header">
      <div class="header__container container">
        <a href="../index.html" class="header__logo">
          <img
            src="../images/logo/SZ_cijelilogo_transparent.png"
            alt="Svijet Zdravlja logo"
            class="header__logo-img"
          />
        </a>

        <nav class="header__nav">
          <ul class="header__nav-list">
            <li class="header__nav-item">
              <a href="../index.html" class="header__nav-link">Početna</a>
            </li>
            <li class="header__nav-item">
              <a href="#" class="header__nav-link">O nama</a>
            </li>
            <li class="header__nav-item">
              <a href="#" class="header__nav-link">Usluge</a>
            </li>
            <li class="header__nav-item">
              <a href="blog.html" class="header__nav-link">Blog</a>
            </li>
            <li class="header__nav-item">
              <a href="../contact.html" class="header__nav-link">Kontakt</a>
            </li>
          </ul>
        </nav>

        <button
          class="header__hamburger"
          aria-label="Toggle navigation"
          aria-expanded="false"
        >
          <span class="header__hamburger-line"></span>
          <span class="header__hamburger-line"></span>
          <span class="header__hamburger-line"></span>
        </button>
      </div>
    </header>

    <main class="blog-create">
      <div class="blog-create__container container">
        <div
          id="post-form-loader"
          class="loader-overlay hidden"
          role="status"
          aria-live="polite"
          aria-label="Spremanje objave"
          aria-hidden="true"
        >
          <div class="loader-spinner" aria-hidden="true"></div>
          <div class="loader-text">Spremamo objavu...</div>
        </div>

        <header class="blog-create__header">
          <div>
            <p class="blog__eyebrow">Upravljanje sadržajem</p>
            <h1 id="post-form-heading">Nova objava</h1>
            <p>
              Popunite sve potrebne informacije i kreirajte novu blog objavu.
              Možete je objaviti odmah ili je spremiti kao skicu.
            </p>
          </div>
          <a href="blog.html" class="btn btn--secondary">Natrag na popis</a>
        </header>

        <form id="post-form" novalidate enctype="multipart/form-data">
          <!-- OSNOVNE INFORMACIJE -->
          <section class="form__section">
            <h2 class="form__section-title">Osnovne informacije</h2>

            <div class="form__grid">
              <div class="form__group form__group--full">
                <label for="post-title">Naslov objave *</label>
                <input
                  type="text"
                  id="post-title"
                  name="title"
                  required
                  minlength="3"
                  maxlength="255"
                  placeholder="Npr. 5 brzih ideja za zdrav doručak"
                />
                <span class="form__hint"
                  >Minimalno 3 znaka, maksimalno 255.</span
                >
              </div>

              <div class="form__group form__group--full">
                <label for="post-slug">URL slug *</label>
                <input
                  type="text"
                  id="post-slug"
                  name="slug"
                  required
                  placeholder="npr. zdravi-dorucak"
                  pattern="^[a-z0-9]+(?:-[a-z0-9]+)*$"
                />
                <span class="form__hint">
                  Samo mala slova, brojeve i crtice. Mora biti jedinstvena.
                </span>
              </div>

              <div class="form__group form__group--full">
                <label for="post-summary">Sažetak *</label>
                <textarea
                  id="post-summary"
                  name="summary"
                  required
                  minlength="10"
                  maxlength="500"
                  rows="3"
                  placeholder="Kraći opis koji će se prikazati u pregledima..."
                ></textarea>
                <span class="form__hint"
                  >Prikazuje se kao pretpregled objave.</span
                >
              </div>
            </div>
          </section>

          <!-- META PODACI ZA SEO -->
          <section class="form__section">
            <h2 class="form__section-title">SEO optimizacija</h2>

            <div class="form__grid">
              <div class="form__group form__group--full">
                <label for="post-meta-title">Meta naslov</label>
                <input
                  type="text"
                  id="post-meta-title"
                  name="meta_title"
                  maxlength="60"
                  placeholder="Naslov za pretraživače (do 60 znakova)"
                />
                <span class="form__hint"
                  >Ako je prazno, koristi se glavni naslov.</span
                >
              </div>

              <div class="form__group form__group--full">
                <label for="post-meta-description">Meta opis</label>
                <textarea
                  id="post-meta-description"
                  name="meta_description"
                  maxlength="160"
                  rows="2"
                  placeholder="Opis za pretraživače (do 160 znakova)"
                ></textarea>
                <span class="form__hint"
                  >Koristi se u rezultatima pretraživanja.</span
                >
              </div>
            </div>
          </section>

          <!-- SADRŽAJ -->
          <section class="form__section">
            <h2 class="form__section-title">Sadržaj objave</h2>

            <div id="chapters-container" class="chapters">
              <h3 class="chapters__title">Poglavlja objave</h3>
              <div id="chapters-list" class="chapters__list"></div>
              <button
                type="button"
                id="add-chapter-btn"
                class="btn btn--secondary btn--small"
              >
                + Dodaj poglavlje
              </button>
            </div>
          </section>

          <!--媒IJSKI SADRŽAJ -->
          <section class="form__section">
            <h2 class="form__section-title">Naslovna slika</h2>

            <div class="form__group form__group--full">
              <label for="post-hero-image">Naslovna slika *</label>
              <div class="file-upload">
                <input
                  type="file"
                  id="post-hero-image"
                  name="hero_image"
                  required
                  accept="image/jpeg,image/png,image/webp"
                />
                <div class="file-upload__dropzone">
                  <svg
                    class="file-upload__icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                  </svg>
                  <p class="file-upload__text">
                    Prevucite sliku ili <strong>kliknite za odabir</strong>
                  </p>
                  <p class="file-upload__hint">JPG, PNG ili WEBP (max 2 MB)</p>
                </div>
              </div>
              <img
                id="post-hero-preview"
                alt="Pretpregled naslove slike"
                class="form__image-preview"
                hidden
              />
            </div>
          </section>

          <!-- KATEGORIJE -->
          <section class="form__section">
            <h2 class="form__section-title">Kategorije</h2>

            <div class="form__group form__group--full">
              <label for="post-categories">Odaberite kategorije</label>
              <div id="post-categories" class="categories-select">
                <div class="categories-input">
                  <input
                    type="text"
                    id="categories-search"
                    placeholder="Pretraži ili dodaj novu kategoriju..."
                    class="categories-input__field"
                  />
                </div>
                <div id="categories-list" class="categories-list"></div>
              </div>
              <span class="form__hint"
                >Odaberite jednu ili više kategorija za blaži
                pronalaženja.</span
              >
            </div>
          </section>

          <!-- STATUS I OBJAVA -->
          <section class="form__section">
            <h2 class="form__section-title">Status objave</h2>

            <div class="form__grid">
              <div class="form__group">
                <label for="post-status">Status *</label>
                <select id="post-status" name="status" required>
                  <option value="">-- Odaberite status --</option>
                  <option value="DRAFT">Skica (Draft)</option>
                  <option value="PUBLISHED">Objavljena</option>
                  <option value="SCHEDULED">Zakazana</option>
                  <option value="HIDDEN">Skrivena</option>
                  <option value="ARCHIVED">Arhivirana</option>
                </select>
                <span class="form__hint">Odaberite status objave.</span>
              </div>

              <div
                class="form__group"
                id="scheduled-date-group"
                style="display: none"
              >
                <label for="post-scheduled-for">Zakazano za *</label>
                <input
                  type="datetime-local"
                  id="post-scheduled-for"
                  name="scheduled_for"
                />
                <span class="form__hint">Datum i vrijeme objavljivanja.</span>
              </div>

              <div class="form__group form__checkbox">
                <input type="checkbox" id="post-featured" name="is_featured" />
                <label for="post-featured">Istaknut post (Featured)</label>
              </div>
            </div>
          </section>

          <!-- AKCIJE -->
          <div
            class="form__actions"
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div style="display: flex; gap: 1.5rem">
              <button type="submit" id="post-save" class="btn btn--primary">
                Kreiraj objavu
              </button>
              <button type="button" id="post-save-draft" class="btn btn--draft">
                Spremi kao skicu
              </button>
            </div>
            <a href="blog.html" id="post-cancel" class="btn btn--outline">
              Odustani
            </a>
          </div>
        </form>
      </div>
    </main>

    <footer class="footer">
      <div class="footer__container container">
        <div class="footer__content">
          <div class="footer__brand">
            <a href="../index.html" class="footer__logo">
              <img
                src="../images/logo/SZ_cijelilogo_transparent.png"
                alt="Svijet Zdravlja logo"
                class="footer__logo-img"
              />
            </a>
            <p class="footer__description">
              Vaš pouzdani partner za zdravlje i dobrobit.
            </p>
          </div>

          <div class="footer__links">
            <div class="footer__column">
              <h4 class="footer__title">Navigacija</h4>
              <ul class="footer__list">
                <li class="footer__list-item">
                  <a href="../index.html" class="footer__link">Početna</a>
                </li>
                <li class="footer__list-item">
                  <a href="#" class="footer__link">O nama</a>
                </li>
                <li class="footer__list-item">
                  <a href="#" class="footer__link">Usluge</a>
                </li>
                <li class="footer__list-item">
                  <a href="index.html" class="footer__link">Blog</a>
                </li>
              </ul>
            </div>

            <div class="footer__column">
              <h4 class="footer__title">Kontakt</h4>
              <ul class="footer__list">
                <!--
                <li class="footer__list-item">
                  <a href="tel:+385123456789" class="footer__link"
                    >+385 12 345 6789</a>
                </li>
                -->
                <li class="footer__list-item">
                  <a
                    href="mailto:svijetzdravljahr@gmail.com"
                    class="footer__link"
                    >svijetzdravljahr@gmail.com</a
                  >
                </li>
                <li class="footer__list-item">
                  <span class="footer__text">Zagreb, Hrvatska</span>
                </li>
              </ul>
            </div>

            <div class="footer__column">
              <h4 class="footer__title">Pratite nas</h4>
              <ul class="footer__social">
                <!-- <li class="footer__social-item">
                  <a href="#" class="footer__social-link" aria-label="Facebook">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </a>
                </li> -->
                <li class="footer__social-item">
                  <a
                    href="https://www.instagram.com/svijetzdravlja.hr/"
                    class="footer__social-link"
                    aria-label="Instagram"
                  >
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <rect
                        x="2"
                        y="2"
                        width="20"
                        height="20"
                        rx="5"
                        ry="5"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <circle
                        cx="12"
                        cy="12"
                        r="4"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" />
                    </svg>
                  </a>
                </li>
                <li class="footer__social-item">
                  <a
                    href="https://www.youtube.com/@svijet_zdravlja_hr"
                    class="footer__social-link"
                    aria-label="YouTube"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <rect
                        x="2"
                        y="6"
                        width="20"
                        height="12"
                        rx="3"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <polygon points="10,9 16,12 10,15" fill="currentColor" />
                    </svg>
                  </a>
                </li>
                <li class="footer__social-item"></li>
              </ul>
            </div>
          </div>
        </div>

        <div class="footer__bottom">
          <p class="footer__copyright">
            &copy; <span id="current-year"></span> Svijet Zdravlja. Sva prava
            pridržana.
          </p>
        </div>
      </div>
    </footer>

    <!-- Toast container -->
    <div id="toast-container" aria-live="polite"></div>

    <script src="../scripts/config.js"></script>
    <script src="../scripts/main.js"></script>
    <script src="../scripts/admin-form.js"></script>
    <script>
      // Toast helper
      function showToast(message, type = "success") {
        const container = document.getElementById("toast-container");
        if (!container) return;
        const toast = document.createElement("div");
        toast.className = "toast toast-" + type;
        toast.innerHTML = `
          <span>${message}</span>
          <button class="toast__close" aria-label="Zatvori">&times;</button>
          <div class="toast__bar"></div>
        `;
        container.appendChild(toast);

        // Slide in
        setTimeout(() => {
          toast.classList.add("toast-show");
        }, 10);

        // Animate loading bar
        const bar = toast.querySelector(".toast__bar");
        bar.style.transition = "transform 3s linear";
        setTimeout(() => {
          bar.style.transform = "scaleX(0)";
        }, 30);

        // Close on X click
        toast.querySelector(".toast__close").onclick = function (e) {
          e.stopPropagation();
          hideToast(toast);
        };

        // Auto close after 3s
        const hideTimeout = setTimeout(() => hideToast(toast), 3000);

        // Hide function
        function hideToast(toastEl) {
          toastEl.classList.remove("toast-show");
          toastEl.classList.add("toast-hide");
          clearTimeout(hideTimeout);
          setTimeout(() => toastEl.remove(), 400);
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Omogući klik na dropzonu za odabir slike
        var dropzone = document.querySelector(".file-upload__dropzone");
        var fileInput = document.getElementById("post-hero-image");
        if (dropzone && fileInput) {
          dropzone.style.cursor = "pointer";
          dropzone.addEventListener("click", function (e) {
            if (e.target.tagName !== "A" && e.target.tagName !== "BUTTON") {
              fileInput.click();
            }
          });
        }

        // Prikaži "Zakazano za" samo kad je status "SCHEDULED"
        var statusSelect = document.getElementById("post-status");
        var scheduledGroup = document.getElementById("scheduled-date-group");
        function toggleScheduledGroup() {
          if (statusSelect.value === "SCHEDULED") {
            scheduledGroup.style.display = "";
            scheduledGroup.querySelector("input").required = true;
          } else {
            scheduledGroup.style.display = "none";
            scheduledGroup.querySelector("input").required = false;
            scheduledGroup.querySelector("input").value = "";
          }
        }
        if (statusSelect && scheduledGroup) {
          statusSelect.addEventListener("change", toggleScheduledGroup);
          // Inicijalno postavi na temelju trenutnog statusa
          toggleScheduledGroup();
        }

        // Presretni submit forme i prikaži toast (umjesto status div-a)
        var form = document.getElementById("post-form");
        if (form) {
          form.addEventListener("submit", function (e) {
            // Ovdje pretpostavljamo da postoji AJAX/JS logika za spremanje
            // Ovdje samo demo toast, makni e.preventDefault() ako backend postoji
            e.preventDefault();
            // ...pozovi svoju logiku za spremanje...
            showToast("Objava je uspješno spremljena.", "success");
          });
        }

        // Ako imaš gumb za brisanje, npr. #post-delete
        var deleteBtn = document.getElementById("post-delete");
        if (deleteBtn) {
          deleteBtn.addEventListener("click", function () {
            // ...pozovi svoju logiku za brisanje...
            showToast("Objava je izbrisana.", "error");
          });
        }

        // Ako imaš funkciju za odjavu, npr. #logout-btn
        var logoutBtn = document.getElementById("logout-btn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", function () {
            // ...pozovi svoju logiku za odjavu...
            showToast("Uspješno ste odjavljeni.", "info");
          });
        }
      });
    </script>
  </body>
</html>
